<div class="flex flex-column gap-6 p-6 bg-gray-50 min-h-screen w-full">

  <div class="flex flex-wrap gap-4" *ngIf="metrics.length > 0">
    <div *ngFor="let metric of metrics">
      <p-card [styleClass]="getMetricCardClass(metric)" [style]="{'width': '200px', 'height': '150px'}"
        (click)="filterReservations(metric.title)">
        <div class="flex flex-column align-items-center justify-content-center text-center py-3 h-full">
          <span class="text-gray-600 font-bold mb-2 text-sm">{{ metric.title }}</span>
          <span class="text-4xl font-bold" [ngClass]="getMetricTextClass(metric, 600)">{{ metric.value }}</span>
          <span class="text-xs text-gray-500 mt-2">{{ metric.subtext }}</span>
        </div>
      </p-card>
    </div>
  </div>



  <div class="bg-white border-round-xl border-1 border-gray-100 shadow-3 overflow-hidden flex flex-column">

    <div
      class="flex flex-wrap align-items-center justify-content-between p-4 gap-4 border-bottom-1 border-gray-100 bg-white">

      <!-- Title Section -->
      <div class="flex align-items-center gap-3">
        <div class="bg-blue-50 p-2 border-round-lg flex align-items-center justify-content-center text-blue-600"
          style="width: 40px; height: 40px;">
          <i class="pi pi-list text-xl"></i>
        </div>
        <div class="flex flex-column">
          <span class="text-gray-900 font-bold text-lg">รายการการจอง</span>
          <span class="text-gray-500 text-xs">ข้อมูลการจองทั้งหมด {{ reservations.length }} รายการ</span>
        </div>
      </div>

      <!-- Filters Section -->
      <div class="flex flex-wrap align-items-center gap-3">

        <!-- Date Filter -->
        <p-calendar [(ngModel)]="selectedDate" dateFormat="dd/mm/yy" placeholder="เลือกวันที่จอง" [showIcon]="true"
          [showClear]="true" (onSelect)="onDateChange()" (onClear)="clearDate()"
          styleClass="p-inputtext-sm w-12rem border-round-2xl">
        </p-calendar>

        <!-- Search Input -->
        <span class="p-input-icon-left">
          <i class="pi pi-search text-gray-400"></i>
          <input type="text" pInputText placeholder="ค้นหาผู้ใช้งาน (User ID / ชื่อ)"
            class="p-inputtext-sm w-15rem border-round-2xl border-gray-300" />
        </span>

      </div>
    </div>

    <p-table [value]="reservations" [(selection)]="selectedReservations" [paginator]="true" [rows]="10"
      responsiveLayout="scroll" styleClass="p-datatable-sm" [customSort]="true" (sortFunction)="customSort($event)"
      sortField="reserved_at_date" [sortOrder]="-1">

      <ng-template pTemplate="header">
        <tr class="bg-gray-50 text-gray-600 text-sm">
          <th style="width: 4rem"><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th>
          <th pSortableColumn="reserved_at_date">วันที่ทำรายการ <p-sortIcon field="reserved_at_date"></p-sortIcon></th>
          <th pSortableColumn="user_id">User ID <p-sortIcon field="user_id"></p-sortIcon></th>
          <th pSortableColumn="date">วันที่จอง <p-sortIcon field="date"></p-sortIcon></th>
          <th pSortableColumn="room">อาคาร <p-sortIcon field="room"></p-sortIcon></th>
          <th pSortableColumn="floor_name">ชั้น/โซน <p-sortIcon field="floor_name"></p-sortIcon></th>
          <th pSortableColumn="type">ประเภท <p-sortIcon field="type"></p-sortIcon></th>
          <th pSortableColumn="status">สถานะ <p-sortIcon field="status"></p-sortIcon></th>
          <th>จัดการ</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-res>
        <tr class="text-sm hover:bg-gray-50 transition-colors border-bottom-1 border-gray-50">
          <td><p-tableCheckbox [value]="res"></p-tableCheckbox></td>
          <td>
            <div class="flex flex-column">
              <span class="font-semibold">{{ res.reserved_at_date }}</span>
              <span class="text-xs text-gray-500">{{ res.reserved_at_time }}</span>
            </div>
          </td>
          <td>
            <div class="flex items-center gap-3">
              <div class="flex flex-column">
                <span class="font-semibold text-gray-800">{{ res.user }}</span>
                <span class="text-xs text-gray-500">user_id : {{ res.user_id }}</span>
              </div>
            </div>
          </td>
          <td>
            <div class="flex flex-column">
              <span class="font-semibold">{{ res.date }}</span>
              <span class="text-xs text-gray-500">{{ res.time }}</span>
            </div>
          </td>
          <td>
            <div class="flex flex-column">
              <span class="font-semibold">{{ res.building_name }}</span>
              <span class="text-xs text-gray-500">{{ res.room }}</span>
            </div>
          </td>
          <td>
            <div class="flex flex-column">
              <span class="font-semibold">{{ res.floor_name || ('ชั้น ' + res.floor) || '-' }}</span>
              <span class="text-xs text-gray-500">Zone {{ getZone(res.room) }}</span>
            </div>
          </td>
          <td>{{ res.type }}</td>
          <td>
            <p-tag [value]="res.status" [severity]="getSeverity(res.status)" [rounded]="true"
              [style]="getCustomTagStyle(res.status)" styleClass="font-medium px-2 py-1"></p-tag>
          </td>
          <td>
            <div class="flex gap-2">
              <p-button label="เพิ่มเติม" [link]="true" styleClass="p-0 text-blue-500 text-xs"></p-button>
              <p-button label="ลบ" [link]="true" styleClass="p-0 text-blue-400 text-xs"></p-button>
              <p-button label="ดูประวัติ" [link]="true" styleClass="p-0 text-blue-300 text-xs"></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>